# Assuming this variable is already created:
# customer_product_matrix = df.pivot_table(index='CustomerID', columns='Description', values='Quantity', aggfunc='sum').fillna(0)

from sklearn.metrics.pairwise import cosine_similarity

# Compute cosine similarity between products (i.e., columns)
product_similarity = cosine_similarity(customer_product_matrix.T)

# Convert to DataFrame
product_similarity_df = pd.DataFrame(
    product_similarity,
    index=customer_product_matrix.columns,
    columns=customer_product_matrix.columns
)

# Save the similarity matrix
joblib.dump(product_similarity_df, "product_similarity.pkl", protocol=4)
print("âœ… product_similarity.pkl saved successfully.")
