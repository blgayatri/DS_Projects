import pandas as pd
from sklearn.metrics.pairwise import cosine_similarity
import joblib

# Create a customer-product matrix
customer_product_matrix = df.pivot_table(
    index='CustomerID',
    columns='Description',
    values='Quantity',
    aggfunc='sum'
).fillna(0)

# Compute cosine similarity between products (i.e., between columns)
product_similarity = cosine_similarity(customer_product_matrix.T)

# Convert to DataFrame for better usability
product_similarity_df = pd.DataFrame(
    product_similarity,
    index=customer_product_matrix.columns,
    columns=customer_product_matrix.columns
)

# Save the similarity matrix as a .pkl file
joblib.dump(product_similarity_df, 'product_similarity.pkl')

print("âœ… product_similarity.pkl saved successfully.")
